<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Browser Connection Issue</title>
</head>
<body>
    <h1>Debug Browser Connection Test</h1>
    <button id="testConnection">Test Connection</button>
    <div id="results"></div>

    <script>
        async function testConnection() {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '<p>Testing connection...</p>';
            
            console.log('Page origin:', window.location.origin);
            console.log('Page hostname:', window.location.hostname);
            
            const endpoint = 'http://127.0.0.1:3001/api/debug-log';
            console.log('Target endpoint:', endpoint);
            
            const testData = {
                logs: [{
                    level: 'debug',
                    message: 'Browser test debug message',
                    timestamp: new Date().toISOString(),
                    category: 'test',
                    sessionId: 'a38e7cf1-e10b-44e0-9f4b-ec0ce87d71f1',
                    source: 'debug-browser-connection.html:1'
                }]
            };

            try {
                console.log('Making fetch request...');
                const response = await fetch(endpoint, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(testData),
                });

                console.log('Response status:', response.status);
                console.log('Response headers:', [...response.headers.entries()]);

                if (response.ok) {
                    const result = await response.json();
                    resultsDiv.innerHTML = `
                        <h3>‚úÖ Success!</h3>
                        <p>Status: ${response.status} ${response.statusText}</p>
                        <p>Result: <pre>${JSON.stringify(result, null, 2)}</pre></p>
                    `;
                    console.log('Success! Server response:', result);
                } else {
                    const errorText = await response.text();
                    resultsDiv.innerHTML = `
                        <h3>‚ùå HTTP Error</h3>
                        <p>Status: ${response.status} ${response.statusText}</p>
                        <p>Error: <pre>${errorText}</pre></p>
                    `;
                    console.error('HTTP Error:', response.status, errorText);
                }

            } catch (error) {
                resultsDiv.innerHTML = `
                    <h3>üö® Network Error</h3>
                    <p>Error: ${error.message}</p>
                    <p>Type: ${error.constructor.name}</p>
                    <p>Code: ${error.code || 'N/A'}</p>
                `;
                console.error('Network error:', error);
                
                if (error.message.includes('ERR_CONNECTION_REFUSED')) {
                    console.log('This is the same net::ERR_CONNECTION_REFUSED we\'re seeing!');
                }
            }
        }

        document.getElementById('testConnection').addEventListener('click', testConnection);
        
        // Auto-test on load
        window.addEventListener('load', testConnection);
    </script>
</body>
</html>