T-12 Parser Upgrade
Goals

Stop mutating nodes; emit distinct ArrayIterationStep objects.

Depth enforcement via createDepthGuard.

Tokenizer injection ready.

Files to modify

scopeDsl/parser/parser.js

scopeDsl/parser/tokenizer.js (no functional change but exported)

tests update.

Key Steps

Replace node.isArray=true path with construction:

node = { type:'ArrayIterationStep', parent: node }
At each edge in parseTerm, call guard.ensure(depth+1).

Constructor: constructor(input, tokenizer = new Tokenizer(input)).

Acceptance

Old characterisation tests still pass.

New tests check immutability (Object.freeze clones cannot be mutated).