T-04 Cycle Detector Utility
Goal â€“ Isolate cycle detection logic.

Files

scopeDsl/core/cycleDetector.js

tests/core/cycleDetector.test.js

Implementation outline

import ScopeCycleError from '../../errors/scopeCycleError.js';

export default function createCycleDetector() {
const stack = [];
return {
enter(key) {
if (stack.includes(key)) {
throw new ScopeCycleError(Cycle: ${[...stack, key].join(' -> ')}, [...stack, key]);
}
stack.push(key);
},
leave() { stack.pop(); }
};
}
Tests

Enters unique keys fine.

Throws on repeated key in stack.

leave() pops correctly.

Acceptance

100 % branch coverage for detector.