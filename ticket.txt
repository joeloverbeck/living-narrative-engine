-03 Depth Guard Utility
Goal – Extract stateless depth checking.

Files

scopeDsl/core/depthGuard.js

tests/unit/scopeDsl/core/depthGuard.test.js

Implementation

import ScopeDepthError from '../../errors/scopeDepthError.js';
export default function createDepthGuard(maxDepth) {
return {
ensure(level) {
if (level > maxDepth) {
throw new ScopeDepthError(
Depth ${level} exceeds ${maxDepth}, level, maxDepth
);
}
}
};
}

Tests

ensure does not throw when level ≤ max.

Throws exact error instance when level > max.

Acceptance

Utility has 100 % statement coverage.

No change in public behaviour (engine still uses inline checks for now).