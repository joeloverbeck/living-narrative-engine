{
  "$schema": "schema://living-narrative-engine/rule.schema.json",
  "id": "music:handle_set_triumphant_mood",
  "description": "Handle setting triumphant mood on instrument performance",
  "event": "music:event-is-action-set-triumphant-mood",
  "operations": [
    {
      "type": "QUERY_LOOKUP",
      "lookup_id": "music:mood_lexicon",
      "entry_key": "triumphant",
      "result_variable": "mood_data",
      "missing_value": {
        "adj": "triumphant",
        "adjectives": "triumphant",
        "noun": "triumphant"
      }
    },
    {
      "type": "SET_VARIABLE",
      "variable_name": "actor_name",
      "value": {"var": "actor.components.core:actor.name"}
    },
    {
      "type": "SET_VARIABLE",
      "variable_name": "instrument_name",
      "value": {"var": "target.components.core:actor.name"}
    },
    {
      "type": "MODIFY_COMPONENT",
      "entity_ref": "target",
      "component_type": "music:performance_mood",
      "data": {
        "mood": "triumphant",
        "set_by_actor": {"var": "actor.id"}
      }
    },
    {
      "type": "DISPATCH_PERCEPTIBLE_EVENT",
      "event": {
        "type": "music_mood_set",
        "actorId": {"var": "actor.id"},
        "targetId": {"var": "target.id"},
        "mood": "triumphant",
        "message": {
          "cat": [
            {"var": "actor_name"},
            " begins to play ",
            {"var": "instrument_name"},
            " with a ",
            {"var": "mood_data.adj"},
            ", triumphant tone"
          ]
        }
      }
    }
  ]
}
