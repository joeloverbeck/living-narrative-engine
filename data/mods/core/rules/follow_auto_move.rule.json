{
  "$schema": "http://example.com/schemas/rule.schema.json",
  "rule_id": "core_follow_auto_move",
  "comment": "After a leader moves, find co-located followers using QUERY_ENTITIES and move them, dispatching events to log the auto-move and inform the UI.",
  "event_type": "core:entity_moved",
  "condition": {
    "!==": [
      {
        "var": "actor"
      },
      null
    ]
  },
  "actions": [
    {
      "type": "REBUILD_LEADER_LIST_CACHE",
      "comment": "First, authoritatively rebuild the leader's follower list for other systems.",
      "parameters": {
        "leaderIds": ["{event.payload.entityId}"]
      }
    },
    {
      "type": "AUTO_MOVE_FOLLOWERS",
      "parameters": {
        "leader_id": "{event.payload.entityId}",
        "destination_id": "{event.payload.currentLocationId}"
      }
    }
  ]
}
