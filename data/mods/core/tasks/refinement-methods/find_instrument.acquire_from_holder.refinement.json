{
  "$schema": "schema://living-narrative-engine/refinement-method.schema.json",
  "id": "core:find_instrument.acquire_from_holder",
  "taskId": "core:find_instrument",
  "description": "Acquire an instrument from another entity that currently holds or owns it. This could involve trading, asking, borrowing, or other social interactions. This method is used when the actor knows who has the desired instrument but doesn't have direct access to it.",
  "applicability": {
    "description": "Instrument must be held by a known entity who is accessible",
    "condition": {
      "and": [
        {"has_component": ["task.params.instrument", "core:held_by"]},
        {"has_component": ["task.params.holder", "core:accessible"]},
        {"has_component": ["task.params.holder", "core:interactable"]}
      ]
    }
  },
  "steps": [
    {
      "stepType": "primitive_action",
      "actionId": "movement:approach_entity",
      "targetBindings": {
        "target": "task.params.holder"
      },
      "description": "Approach the entity holding the instrument"
    },
    {
      "stepType": "conditional",
      "description": "Check relationship and determine best acquisition approach",
      "condition": {
        "or": [
          {"has_component": ["task.params.holder", "core:friendly"]},
          {"has_component": ["task.params.holder", "core:tradeable"]}
        ]
      },
      "thenSteps": [
        {
          "stepType": "primitive_action",
          "actionId": "social:request_item",
          "targetBindings": {
            "target": "task.params.holder",
            "item": "task.params.instrument"
          },
          "parameters": {
            "requestType": "borrow",
            "polite": true
          },
          "description": "Politely request or trade for the instrument"
        }
      ],
      "elseSteps": [
        {
          "stepType": "primitive_action",
          "actionId": "social:offer_trade",
          "targetBindings": {
            "target": "task.params.holder",
            "item": "task.params.instrument"
          },
          "parameters": {
            "offerValue": "fair"
          },
          "description": "Offer trade for the instrument"
        }
      ],
      "onFailure": "replan"
    }
  ],
  "fallbackBehavior": "replan"
}
