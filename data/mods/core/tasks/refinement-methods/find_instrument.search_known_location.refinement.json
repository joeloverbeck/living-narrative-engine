{
  "$schema": "schema://living-narrative-engine/refinement-method.schema.json",
  "id": "core:find_instrument.search_known_location",
  "taskId": "core:find_instrument",
  "description": "Search a known location for the desired instrument. The actor travels to a location they believe contains the instrument and systematically searches for it. This method is used when the actor has knowledge of potential instrument locations but needs to perform active searching.",
  "applicability": {
    "description": "Actor must know a location that potentially contains the desired instrument type",
    "condition": {
      "and": [
        {"has_component": ["task.params.location", "core:searchable"]},
        {">": [
          {"var": "task.params.search_probability"},
          0.3
        ]}
      ]
    }
  },
  "steps": [
    {
      "stepType": "primitive_action",
      "actionId": "movement:move_to_location",
      "targetBindings": {
        "location": "task.params.location"
      },
      "description": "Travel to the known instrument location"
    },
    {
      "stepType": "primitive_action",
      "actionId": "interaction:search_location",
      "targetBindings": {
        "location": "task.params.location"
      },
      "parameters": {
        "searchType": "thorough",
        "targetCategory": "instrument"
      },
      "description": "Perform thorough search of the location"
    },
    {
      "stepType": "conditional",
      "description": "Check if instrument was found during search",
      "condition": {
        "has_component": ["actor", "core:search_successful"]
      },
      "thenSteps": [
        {
          "stepType": "primitive_action",
          "actionId": "items:pick_up_item",
          "targetBindings": {
            "item": "task.params.instrument"
          },
          "description": "Pick up the found instrument"
        }
      ],
      "elseSteps": [
        {
          "stepType": "primitive_action",
          "actionId": "knowledge:update_location_info",
          "targetBindings": {
            "location": "task.params.location"
          },
          "parameters": {
            "update": "no_instrument_found",
            "confidence": 0.8
          },
          "description": "Update knowledge about this location"
        }
      ],
      "onFailure": "replan"
    }
  ],
  "fallbackBehavior": "replan"
}
