{
  "$schema": "schema://living-narrative-engine/task.schema.json",
  "id": "core:find_instrument",
  "description": "Find a specific type of instrument (musical, tool, weapon, etc.) that the actor needs for a particular purpose. This is a knowledge-gated task - the actor must know about potential instrument locations through exploration, rumors, or prior knowledge. The task involves searching known locations and potentially acquiring the instrument through various means.",
  "structuralGates": {
    "description": "Actor must have instrument knowledge capability (ability to recognize and categorize instruments)",
    "condition": {
      "has_component": ["actor", "core:instrument_knowledge"]
    }
  },
  "planningScope": "core:known_instrument_locations",
  "planningPreconditions": [
    {
      "description": "Actor must have a specific need or goal requiring an instrument",
      "condition": {
        "has_component": ["actor", "core:instrument_need"]
      }
    },
    {
      "description": "Actor must know about at least one potential location",
      "condition": {
        ">": [
          {"var": "task.params.location_count"},
          0
        ]
      }
    },
    {
      "description": "Actor must have capacity to carry the instrument (if planning to take it)",
      "condition": {
        "or": [
          {"has_component": ["actor", "core:free_hands"]},
          {"has_component": ["actor", "core:inventory_space"]}
        ]
      }
    }
  ],
  "planningEffects": [
    {
      "type": "ADD_COMPONENT",
      "parameters": {
        "entityId": "actor",
        "componentId": "core:has_instrument",
        "data": {
          "instrumentId": "task.params.instrument",
          "instrumentType": "task.params.instrument_type"
        }
      }
    },
    {
      "type": "REMOVE_COMPONENT",
      "parameters": {
        "entityId": "actor",
        "componentId": "core:instrument_need"
      }
    },
    {
      "type": "MODIFY_COMPONENT",
      "parameters": {
        "entityId": "task.params.instrument",
        "componentId": "core:ownership",
        "updates": {
          "ownerId": "actor",
          "acquired": true
        }
      }
    }
  ],
  "refinementMethods": [
    {
      "methodId": "core:find_instrument.search_known_location",
      "$ref": "./refinement-methods/find_instrument.search_known_location.refinement.json"
    },
    {
      "methodId": "core:find_instrument.acquire_from_holder",
      "$ref": "./refinement-methods/find_instrument.acquire_from_holder.refinement.json"
    }
  ],
  "cost": 20,
  "priority": 45
}
