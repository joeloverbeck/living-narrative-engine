{
  "$schema": "schema://living-narrative-engine/task.schema.json",
  "id": "core:arm_self",
  "description": "Arm oneself with a weapon for self-defense or combat purposes. This task involves finding a suitable weapon, ensuring the actor can wield it, and equipping it properly. The actor must know about available weapons and have the physical capability to use them. This is a multi-precondition task that checks for combat readiness, weapon availability, and wielding capability.",
  "structuralGates": {
    "description": "Actor must have combat capability (limbs, appendages, or other means to wield weapons)",
    "condition": {
      "and": [
        {"has_component": ["actor", "core:combat_capable"]},
        {"or": [
          {"has_component": ["actor", "core:hands"]},
          {"has_component": ["actor", "core:appendages"]},
          {"has_component": ["actor", "core:weapon_wielding_capability"]}
        ]}
      ]
    }
  },
  "planningScope": "core:known_weapons_nearby",
  "planningPreconditions": [
    {
      "description": "Actor must perceive a threat or have a combat-related goal",
      "condition": {
        "or": [
          {"has_component": ["actor", "core:perceives_threat"]},
          {"has_component": ["actor", "core:combat_goal"]},
          {"has_component": ["actor", "core:self_defense_need"]}
        ]
      }
    },
    {
      "description": "Actor must not already be armed with a suitable weapon",
      "condition": {
        "not": {"has_component": ["actor", "core:armed"]}
      }
    },
    {
      "description": "Weapon must be accessible and appropriate for actor's capabilities",
      "condition": {
        "and": [
          {"has_component": ["task.params.weapon", "core:accessible"]},
          {"not": {"has_component": ["task.params.weapon", "core:too_heavy"]}},
          {"not": {"has_component": ["task.params.weapon", "core:requires_training"]}}
        ]
      }
    },
    {
      "description": "Actor must have free appendages to wield the weapon",
      "condition": {
        "or": [
          {"has_component": ["actor", "core:free_hands"]},
          {"has_component": ["actor", "core:free_appendages"]}
        ]
      }
    }
  ],
  "planningEffects": [
    {
      "type": "ADD_COMPONENT",
      "parameters": {
        "entityId": "actor",
        "componentId": "core:armed",
        "data": {
          "weaponId": "task.params.weapon",
          "weaponType": "task.params.weapon_type",
          "readiness": "combat_ready"
        }
      }
    },
    {
      "type": "ADD_COMPONENT",
      "parameters": {
        "entityId": "actor",
        "componentId": "core:wielding",
        "data": {
          "itemId": "task.params.weapon",
          "hand": "primary"
        }
      }
    },
    {
      "type": "MODIFY_COMPONENT",
      "parameters": {
        "entityId": "task.params.weapon",
        "componentId": "core:equipped_by",
        "updates": {
          "actorId": "actor",
          "equipped": true
        }
      }
    },
    {
      "type": "REMOVE_COMPONENT",
      "parameters": {
        "entityId": "actor",
        "componentId": "core:self_defense_need"
      }
    }
  ],
  "refinementMethods": [
    {
      "methodId": "core:arm_self.pick_up_and_wield",
      "$ref": "./refinement-methods/arm_self.pick_up_and_wield.refinement.json"
    },
    {
      "methodId": "core:arm_self.draw_from_inventory",
      "$ref": "./refinement-methods/arm_self.draw_from_inventory.refinement.json"
    }
  ],
  "cost": 15,
  "priority": 65
}
