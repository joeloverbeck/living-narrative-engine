{
  "$schema": "schema://living-narrative-engine/component.schema.json",
  "id": "core:perceptible_event",
  "description": "Dispatched when an action or occurrence happens that should be perceptible to entities within a specific location. This event is intended to be logged by observers for creating a history of local happenings.",
  "payloadSchema": {
    "type": "object",
    "description": "Payload for the core:perceptible_event.",
    "required": [
      "eventName",
      "locationId",
      "descriptionText",
      "timestamp",
      "perceptionType",
      "actorId"
    ],
    "properties": {
      "eventName": {
        "description": "Confirms the type of event.",
        "const": "core:perceptible_event"
      },
      "locationId": {
        "$ref": "schema://living-narrative-engine/common.schema.json#/definitions/namespacedId",
        "description": "The ID of the location where the event occurred and can be perceived."
      },
      "originLocationId": {
        "$ref": "schema://living-narrative-engine/common.schema.json#/definitions/namespacedId",
        "description": "Optional. The originating location ID for loop prevention during sensorial propagation."
      },
      "descriptionText": {
        "type": "string",
        "description": "A human-readable text summarizing the event (e.g., 'Character A leaves towards the north.', 'Character B picks up the Rusty Key.'). This is the primary text to be stored in perception logs."
      },
      "timestamp": {
        "type": "string",
        "format": "date-time",
        "description": "ISO 8601 timestamp indicating when the event occurred. Essential for ordering and summarizing recent events."
      },
      "perceptionType": {
        "description": "A category for the type of perceptible event, aiding in filtering or specific processing by observers (including LLMs).",
        "allOf": [
          {
            "$ref": "schema://living-narrative-engine/common.schema.json#/definitions/perceptionType"
          }
        ]
      },
      "actorId": {
        "$ref": "schema://living-narrative-engine/common.schema.json#/definitions/namespacedId",
        "description": "The ID of the entity primarily responsible for causing the event."
      },
      "targetId": {
        "$ref": "schema://living-narrative-engine/common.schema.json#/definitions/nullableNamespacedId",
        "description": "Optional. The ID of the primary entity or item targeted by the event (e.g., who was spoken to, what item was picked up)."
      },
      "involvedEntities": {
        "type": "array",
        "description": "Optional. An array of other entity IDs that were involved or directly affected by the event, beyond the primary actor and target. (e.g., multiple recipients of an effect).",
        "items": {
          "$ref": "schema://living-narrative-engine/common.schema.json#/definitions/namespacedId"
        },
        "default": []
      },
      "contextualData": {
        "type": "object",
        "description": "Optional. A flexible field for additional, structured data specific to the perceptionType. This could include details like the exact words spoken, the specific item definition ID for a pickup, or the direction of movement for an exit. Useful for more advanced AI reasoning.",
        "additionalProperties": true,
        "default": {}
      },
      "actorDescription": {
        "type": ["string", "null"],
        "description": "First-person description delivered to the actor. The actor always receives this regardless of sensory state (they know what they're doing)."
      },
      "targetDescription": {
        "type": ["string", "null"],
        "description": "Target-perspective description delivered to the target entity. Sensory filtering still applies."
      },
      "alternateDescriptions": {
        "type": ["object", "null"],
        "description": "Alternative event descriptions for different sensory contexts (auditory, tactile, olfactory, limited).",
        "properties": {
          "auditory": {
            "type": "string",
            "description": "Description when perceived through hearing"
          },
          "tactile": {
            "type": "string",
            "description": "Description when perceived through touch"
          },
          "olfactory": {
            "type": "string",
            "description": "Description when perceived through smell"
          },
          "limited": {
            "type": "string",
            "description": "Fallback description when primary and specific senses are unavailable"
          }
        },
        "additionalProperties": false
      },
      "senseAware": {
        "type": "boolean",
        "description": "When true (default), applies sense-based filtering. When false, all recipients receive event regardless of sensory state.",
        "default": true
      }
    },
    "additionalProperties": false
  }
}
