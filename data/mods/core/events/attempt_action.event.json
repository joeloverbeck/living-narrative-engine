{
  "$schema": "schema://living-narrative-engine/component.schema.json",
  "id": "core:attempt_action",
  "description": "Enhanced event schema for both single and multi-target actions, dispatched when an actor tries to perform an action.",
  "payloadSchema": {
    "description": "Defines the structure of the data payload for the 'core:attempt_action' event with multi-target support.",
    "type": "object",
    "required": ["eventName", "actorId", "actionId", "originalInput"],
    "properties": {
      "eventName": {
        "description": "Confirms the type of event.",
        "const": "core:attempt_action"
      },
      "actorId": {
        "$ref": "schema://living-narrative-engine/common.schema.json#/definitions/namespacedId",
        "description": "The ID of the entity attempting the action."
      },
      "actionId": {
        "$ref": "schema://living-narrative-engine/common.schema.json#/definitions/namespacedId",
        "description": "The ID of the action being attempted."
      },
      "targets": {
        "type": "object",
        "description": "Multi-target structure with named targets for complex actions",
        "additionalProperties": {
          "type": "string",
          "minLength": 1,
          "description": "Target entity ID"
        },
        "examples": [
          {
            "primary": "entity_123",
            "secondary": "entity_456"
          },
          {
            "person": "alice_789",
            "clothing": "dress_012"
          },
          {
            "item": "knife_345",
            "target": "goblin_678"
          }
        ]
      },
      "targetId": {
        "$ref": "schema://living-narrative-engine/common.schema.json#/definitions/nullableNamespacedId",
        "description": "Primary target for backward compatibility with legacy rules"
      },
      "originalInput": {
        "type": "string",
        "minLength": 1,
        "description": "The exact command or input string entered by the player or generated by AI."
      },
      "timestamp": {
        "type": "number",
        "description": "Event creation timestamp",
        "minimum": 0
      }
    },
    "additionalProperties": false,
    "anyOf": [
      {
        "description": "Legacy format: requires targetId",
        "required": ["targetId"]
      },
      {
        "description": "Multi-target format: requires targets and targetId as primary",
        "required": ["targets", "targetId"],
        "properties": {
          "targets": {
            "minProperties": 1
          },
          "targetId": {
            "type": "string",
            "minLength": 1
          }
        }
      }
    ]
  }
}
