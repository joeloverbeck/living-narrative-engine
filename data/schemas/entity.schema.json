{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "http://example.com/schemas/entity.schema.json",
  "title": "Game Entity Schema",
  "description": "Schema for a game entity (player, NPC, item, etc.) composed of modular components. Each entity is defined by a unique id and a collection of components that determine its attributes and behavior.",
  "type": "object",
  "properties": {
    "id": {
      "type": "string",
      "description": "Unique identifier for this entity. Typically includes a module prefix and specific name (e.g., \"core:player\", \"demo:item_key\").",
      "pattern": "^[a-zA-Z0-9_\\-:]+$"
    },
    "components": {
      "type": "object",
      "description": "Object containing the components that make up this entity. Each key is a component name and its value is the component data object.",
      "properties": {
        "Name": {
          "$ref": "#/definitions/NameComponent",
          "description": "(Optional but recommended) The display name of the entity."
        },
        "Description": {
          "$ref": "#/definitions/DescriptionComponent",
          "description": "(Optional) Static text description of the entity."
        },
        "MetaDescription": {
          "$ref": "#/definitions/MetaDescriptionComponent",
          "description": "(Optional) Data used for LLM-generated descriptions."
        },
        "PositionComponent": {
          "$ref": "#/definitions/PositionComponent",
          "description": "Component for entities whose location is relevant."
        },
        "Health": {
          "$ref": "#/definitions/HealthComponent",
          "description": "(Optional) Component for entities that have health points."
        },
        "Inventory": {
          "$ref": "#/definitions/InventoryComponent",
          "description": "(Optional) Component for entities that can carry items."
        },
        "Attack": {
          "$ref": "#/definitions/AttackComponent",
          "description": "(Optional) Component for entities that can perform basic attacks."
        },
        "Skill": {
          "$ref": "#/definitions/SkillComponent",
          "description": "(Optional) Component tracking entity skill levels (basic MVP version)."
        },
        "Stats": {
          "$ref": "#/definitions/StatsComponent",
          "description": "(Optional) Component tracking entity core attributes (Strength, Agility etc.)."
        },
        "EntitiesPresent": {
          "$ref": "#/definitions/EntitiesPresentComponent",
          "description": "(Optional, usually for locations) Lists IDs of entities within."
        },
        "Connections": {
          "$ref": "#/definitions/ConnectionsComponent",
          "description": "(Optional, for locations) Defines exits to other locations."
        },
        "Equipment": {
          "$ref": "#/definitions/EquipmentComponent",
          "description": "(Optional) Component for entities that can equip items."
        }
      },
      "minProperties": 1,
      "additionalProperties": true
    }
  },
  "required": [
    "id",
    "components"
  ],
  "additionalProperties": false,
  "definitions": {
    "NameComponent": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "value"
      ],
      "properties": {
        "value": {
          "type": "string",
          "description": "The primary display name or title of the entity (e.g., 'Player', 'Goblin Sentry', 'Iron Key')."
        }
      }
    },
    "DescriptionComponent": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "text"
      ],
      "properties": {
        "text": {
          "type": "string",
          "description": "A static description text for the entity."
        }
      }
    },
    "MetaDescriptionComponent": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "keywords"
      ],
      "properties": {
        "keywords": {
          "type": "string",
          "description": "Comma-separated keywords or a short phrase for LLM description generation."
        },
        "style_hint": {
          "type": "string",
          "description": "(Optional) Hint for the LLM about the desired writing style."
        }
      }
    },
    "PositionComponent": {
      "description": "Schema for validating PositionComponent data.",
      "type": "object",
      "properties": {
        "locationId": {
          "description": "The ID of the location entity where the entity resides.",
          "type": "string",
          "minLength": 1
        },
        "x": {
          "description": "The x-coordinate within the location.",
          "type": "number",
          "default": 0
        },
        "y": {
          "description": "The y-coordinate within the location.",
          "type": "number",
          "default": 0
        }
      },
      "required": [
        "locationId"
      ],
      "additionalProperties": false
    },
    "HealthComponent": {
      "type": "object",
      "description": "Tracks the entity's health points.",
      "properties": {
        "current": {
          "type": "integer",
          "description": "Current HP (hit points).",
          "minimum": 0
        },
        "max": {
          "type": "integer",
          "description": "Maximum HP for the entity.",
          "minimum": 1
        }
      },
      "required": [
        "current",
        "max"
      ],
      "additionalProperties": false
    },
    "InventoryComponent": {
      "type": "object",
      "description": "Holds a list of item IDs the entity carries.",
      "properties": {
        "items": {
          "type": "array",
          "description": "Array of item entity identifier strings currently in the entity's inventory.",
          "items": {
            "type": "string",
            "pattern": "^[a-zA-Z0-9_\\-:]+$"
          },
          "default": []
        }
      },
      "required": [
        "items"
      ],
      "additionalProperties": false
    },
    "AttackComponent": {
      "type": "object",
      "description": "Defines the entity's base attack capability for MVP.",
      "properties": {
        "damage": {
          "type": "integer",
          "description": "Base damage or attack strength value.",
          "minimum": 0
        }
      },
      "required": [
        "damage"
      ],
      "additionalProperties": false
    },
    "SkillComponent": {
      "type": "object",
      "description": "Tracks the entity's basic skill levels for MVP.",
      "properties": {
        "skills": {
          "type": "object",
          "description": "A map of skill IDs (e.g., 'core:skill_strength') to their current integer value.",
          "additionalProperties": {
            "type": "integer",
            "minimum": 0
          },
          "examples": [
            {
              "core:skill_strength": 5,
              "core:skill_perception": 3
            }
          ]
        }
      },
      "required": [
        "skills"
      ],
      "additionalProperties": false
    },
    "StatsComponent": {
      "type": "object",
      "description": "Tracks the entity's core attributes (stats).",
      "properties": {
        "attributes": {
          "type": "object",
          "description": "A map of attribute IDs (e.g., 'core:attr_strength') to their current integer value.",
          "additionalProperties": {
            "type": "integer",
            "description": "The integer value of the attribute.",
            "minimum": 0
          },
          "propertyNames": {
            "description": "Attribute ID, following pattern e.g., 'core:attr_strength'",
            "pattern": "^[a-zA-Z0-9_\\-:]+$"
          },
          "examples": [
            {
              "core:attr_strength": 8,
              "core:attr_agility": 12,
              "core:attr_intelligence": 10,
              "core:attr_constitution": 9
            }
          ]
        }
      },
      "required": [
        "attributes"
      ],
      "additionalProperties": false
    },
    "EntitiesPresentComponent": {
      "type": "object",
      "description": "Lists the IDs of entities currently present within this entity (typically used for Locations).",
      "properties": {
        "entityIds": {
          "type": "array",
          "description": "Array of entity identifier strings present.",
          "items": {
            "type": "string",
            "pattern": "^[a-zA-Z0-9_\\-:]+$"
          },
          "default": []
        }
      },
      "required": [
        "entityIds"
      ],
      "additionalProperties": false
    },
    "ConnectionsComponent": {
      "type": "object",
      "description": "Defines exits from a location.",
      "properties": {
        "exits": {
          "type": "object",
          "description": "Map where keys are directions (or exit names) and values are target location IDs.",
          "additionalProperties": {
            "type": "string",
            "pattern": "^[a-zA-Z0-9_\\-:]+$"
          },
          "propertyNames": {
            "description": "Direction or exit name (e.g., 'north', 'south', 'ladder_up')",
            "type": "string"
          },
          "examples": [
            {
              "north": "demo:room_hallway",
              "east": "demo:room_storage"
            }
          ]
        }
      },
      "required": [
        "exits"
      ],
      "additionalProperties": false
    },
    "EquipmentComponent": {
      "type": "object",
      "description": "Tracks items equipped by the entity in specific body slots.",
      "properties": {
        "slots": {
          "type": "object",
          "description": "A map where keys are slot IDs (e.g., 'core:slot_main_hand') and values are the entity ID string of the equipped item, or null if the slot is empty.",
          "additionalProperties": {
            "type": [
              "string",
              "null"
            ],
            "pattern": "^[a-zA-Z0-9_\\-:]+$"
          },
          "propertyNames": {
            "description": "Equipment slot ID, following pattern e.g., 'core:slot_head'",
            "pattern": "^[a-zA-Z0-9_\\-:]+$"
          },
          "examples": [
            {
              "core:slot_main_hand": "demo:item_sword",
              "core:slot_off_hand": null,
              "core:slot_body": "demo:item_leather_armor",
              "core:slot_head": null
            }
          ]
        }
      },
      "required": [
        "slots"
      ],
      "additionalProperties": false
    }
  }
}