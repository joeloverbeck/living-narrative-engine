{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "http://example.com/schemas/entity.schema.json",
  "title": "Game Entity Schema",
  "description": "Schema for a game entity (player, NPC, item, etc.) composed of modular components. Each entity is defined by a unique id and a collection of components that determine its attributes and behavior.",
  "type": "object",
  "properties": {
    "id": {
      "type": "string",
      "description": "Unique identifier for this entity. Typically includes a module prefix and specific name (e.g., \"core:player\", \"demo:item_key\").",
      "pattern": "^[a-zA-Z0-9_\\-:]+$"
    },
    "components": {
      "type": "object",
      "description": "Object containing the components that make up this entity. Each key is a component name and its value is the component data object.",
      "properties": {
        "Name": {
          "$ref": "#/definitions/NameComponent",
          "description": "(Optional but recommended) The display name of the entity."
        },
        "Description": {
          "$ref": "#/definitions/DescriptionComponent",
          "description": "(Optional) Static text description of the entity."
        },
        "MetaDescription": {
          "$ref": "#/definitions/MetaDescriptionComponent",
          "description": "(Optional) Data used for LLM-generated descriptions."
        },
        "Health": {
          "$ref": "#/definitions/HealthComponent",
          "description": "(Optional) Component for entities that have health points."
        },
        "Inventory": {
          "$ref": "#/definitions/InventoryComponent",
          "description": "(Optional) Component for entities that can carry items."
        },
        "Attack": {
          "$ref": "#/definitions/AttackComponent",
          "description": "(Optional) Component for entities that can perform basic attacks."
        },
        "Skill": {
          "$ref": "#/definitions/SkillComponent",
          "description": "(Optional) Component tracking entity skill levels (basic MVP version)."
        },
        "Stats": {
          "$ref": "#/definitions/StatsComponent",
          "description": "(Optional) Component tracking entity core attributes (Strength, Agility etc.)."
        },
        "EntitiesPresent": {
          "$ref": "#/definitions/EntitiesPresentComponent",
          "description": "(Optional, usually for locations) Lists IDs of entities within."
        },
        "Item": {
          "$ref": "#/definitions/ItemComponent",
          "description": "(Optional) Marker component for items."
        },
        "Usable": {
          "$ref": "#/definitions/UsableComponent",
          "description": "(Optional) Defines how an item/object can be used."
        },
        "Connections": {
          "$ref": "#/definitions/ConnectionsComponent",
          "description": "(Optional, for locations) Defines exits to other locations."
        }
      },
      "minProperties": 1,
      "additionalProperties": true
    }
  },
  "required": [
    "id",
    "components"
  ],
  "additionalProperties": false,
  "definitions": {
    "NameComponent": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "value"
      ],
      "properties": {
        "value": {
          "type": "string",
          "description": "The primary display name or title of the entity (e.g., 'Player', 'Goblin Sentry', 'Iron Key')."
        }
      }
    },
    "DescriptionComponent": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "text"
      ],
      "properties": {
        "text": {
          "type": "string",
          "description": "A static description text for the entity."
        }
      }
    },
    "MetaDescriptionComponent": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "keywords"
      ],
      "properties": {
        "keywords": {
          "type": "string",
          "description": "Comma-separated keywords or a short phrase for LLM description generation."
        },
        "style_hint": {
          "type": "string",
          "description": "(Optional) Hint for the LLM about the desired writing style."
        }
      }
    },
    "HealthComponent": {
      "type": "object",
      "description": "Tracks the entity's health points.",
      "properties": {
        "current": {
          "type": "integer",
          "description": "Current HP (hit points).",
          "minimum": 0
        },
        "max": {
          "type": "integer",
          "description": "Maximum HP for the entity.",
          "minimum": 1
        }
      },
      "required": [
        "current",
        "max"
      ],
      "additionalProperties": false
    },
    "InventoryComponent": {
      "type": "object",
      "description": "Holds a list of item IDs the entity carries.",
      "properties": {
        "items": {
          "type": "array",
          "description": "Array of item entity identifier strings currently in the entity's inventory.",
          "items": {
            "type": "string",
            "pattern": "^[a-zA-Z0-9_\\-:]+$"
          },
          "default": []
        }
      },
      "required": [
        "items"
      ],
      "additionalProperties": false
    },
    "AttackComponent": {
      "type": "object",
      "description": "Defines the entity's base attack capability for MVP.",
      "properties": {
        "damage": {
          "type": "integer",
          "description": "Base damage or attack strength value.",
          "minimum": 0
        }
      },
      "required": [
        "damage"
      ],
      "additionalProperties": false
    },
    "SkillComponent": {
      "type": "object",
      "description": "Tracks the entity's basic skill levels for MVP.",
      "properties": {
        "skills": {
          "type": "object",
          "description": "A map of skill IDs (e.g., 'core:skill_strength') to their current integer value.",
          "additionalProperties": {
            "type": "integer",
            "minimum": 0
          },
          "examples": [
            {
              "core:skill_strength": 5,
              "core:skill_perception": 3
            }
          ]
        }
      },
      "required": [
        "skills"
      ],
      "additionalProperties": false
    },
    "StatsComponent": {
      "type": "object",
      "description": "Tracks the entity's core attributes (stats).",
      "properties": {
        "attributes": {
          "type": "object",
          "description": "A map of attribute IDs (e.g., 'core:attr_strength') to their current integer value.",
          "additionalProperties": {
            "type": "integer",
            "description": "The integer value of the attribute.",
            "minimum": 0
          },
          "propertyNames": {
            "description": "Attribute ID, following pattern e.g., 'core:attr_strength'",
            "pattern": "^[a-zA-Z0-9_\\-:]+$"
          },
          "examples": [
            {
              "core:attr_strength": 8,
              "core:attr_agility": 12,
              "core:attr_intelligence": 10,
              "core:attr_constitution": 9
            }
          ]
        }
      },
      "required": [
        "attributes"
      ],
      "additionalProperties": false
    },
    "EntitiesPresentComponent": {
      "type": "object",
      "description": "Lists the IDs of entities currently present within this entity (typically used for Locations).",
      "properties": {
        "entityIds": {
          "type": "array",
          "description": "Array of entity identifier strings present.",
          "items": {
            "type": "string",
            "pattern": "^[a-zA-Z0-9_\\-:]+$"
          },
          "default": []
        }
      },
      "required": [
        "entityIds"
      ],
      "additionalProperties": false
    },
    "ItemComponent": {
      "type": "object",
      "description": "Marker component indicating this entity is an item.",
      "properties": {
        "stackable": {
          "type": "boolean",
          "default": false,
          "description": "Can multiple instances stack?"
        },
        "value": {
          "type": "integer",
          "minimum": 0,
          "description": "(Optional) Base monetary value."
        },
        "tags": {
          "type": "array",
          "description": "Tags for the item.",
          "items": {
            "type": "string",
            "pattern": "^[a-zA-Z0-9_\\-:]+$"
          },
          "default": []
        }
      },
      "additionalProperties": false
    },
    "UsableComponent": {
      "type": "object",
      "description": "Defines how an item or object can be used.",
      "properties": {
        "effect_type": {
          "type": "string",
          "description": "Identifier for the type of effect triggered on use (e.g., 'heal', 'unlock_door', 'apply_status'). Needs interpretation by an Action handler or system."
        },
        "effect_details": {
          "type": "object",
          "description": "(Optional) Provides specific parameters for the effect identified by effect_type (e.g., amount for heal, target ID for unlock, status effect ID).",
          "additionalProperties": true
        },
        "target": {
          "type": "string",
          "pattern": "^[a-zA-Z0-9_\\-:]+$",
          "description": "(Optional) The ID of the specific target entity this item should be used on (e.g., a specific door ID for a key)."
        },
        "consumable": {
          "type": "boolean",
          "default": true,
          "description": "Is the item destroyed after use?"
        },
        "use_message": {
          "type": "string",
          "description": "(Optional) Message displayed to the player upon successful use of the item/object."
        }
      },
      "required": [
        "effect_type"
      ],
      "additionalProperties": false
    },
    "ConnectionsComponent": {
      "type": "object",
      "description": "Defines exits from a location.",
      "properties": {
        "exits": {
          "type": "object",
          "description": "Map where keys are directions (or exit names) and values are target location IDs.",
          "additionalProperties": {
            "type": "string",
            "pattern": "^[a-zA-Z0-9_\\-:]+$"
          },
          "propertyNames": {
            "description": "Direction or exit name (e.g., 'north', 'south', 'ladder_up')",
            "type": "string"
          },
          "examples": [
            {
              "north": "demo:room_hallway",
              "east": "demo:room_storage"
            }
          ]
        }
      },
      "required": [
        "exits"
      ],
      "additionalProperties": false
    }
  }
}