{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "schema://living-narrative-engine/common.schema.json",
  "title": "Common Definitions",
  "definitions": {
    "BaseDefinition": {
      "type": "object",
      "properties": {
        "$schema": {
          "type": "string",
          "format": "uri",
          "description": "Optional. A URI reference to the schema that this document conforms to."
        },
        "id": {
          "$ref": "#/definitions/namespacedId",
          "description": "Required. Unique, namespaced ID for the definition (e.g., 'core:player', 'combat:action_attack')."
        },
        "description": {
          "type": "string",
          "description": "Required. A human-readable explanation of what this definition represents or does."
        }
      },
      "required": ["id", "description"]
    },
    "namespacedId": {
      "description": "A unique identifier string, typically namespaced using a colon (e.g., 'core:player', 'mod_combat:action_attack'). Allows alphanumeric characters, underscore, hyphen, and colon.",
      "type": "string",
      "pattern": "^[a-zA-Z0-9_:-]+$"
    },
    "nullableNamespacedId": {
      "description": "A unique identifier string, typically namespaced (like namespacedId), or null.",
      "oneOf": [
        {
          "$ref": "#/definitions/namespacedId"
        },
        {
          "type": "null"
        }
      ]
    },
    "perceptionType": {
      "description": "Standardized category identifiers for perceptible events used across rules, operations, and analytics.",
      "type": "string",
      "enum": [
        "action_self_general",
        "action_target_general",
        "character_enter",
        "character_exit",
        "combat_attack",
        "combat_effect",
        "container_open_failed",
        "container_opened",
        "error",
        "item_drop",
        "item_dropped",
        "item_examined",
        "item_pickup",
        "item_pickup_failed",
        "item_picked_up",
        "item_put_in_container",
        "item_read",
        "item_taken_from_container",
        "item_transfer",
        "item_transfer_failed",
        "item_use",
        "liquid_consumed",
        "liquid_consumed_entirely",
        "notes_jotted",
        "put_in_container_failed",
        "speech_local",
        "state_change_observable",
        "take_from_container_failed",
        "thought_internal"
      ]
    },
    "entityReference": {
      "description": "Specifies an entity. Can be a keyword ('actor', 'target'), a direct non-empty entity ID string, or an object containing the entity ID.",
      "oneOf": [
        {
          "type": "string",
          "description": "Keyword ('actor', 'target') or direct entity ID string.",
          "minLength": 1,
          "pattern": "^\\S(.*\\S)?$"
        },
        {
          "type": "object",
          "properties": {
            "entityId": {
              "type": "string",
              "description": "The specific entity ID.",
              "minLength": 1,
              "pattern": "^\\S(.*\\S)?$"
            }
          },
          "required": ["entityId"],
          "additionalProperties": false,
          "description": "Reference via explicit entityId property."
        }
      ]
    },
    "structuredNote": {
      "type": "object",
      "description": "A structured note with categorized subject information",
      "properties": {
        "text": {
          "type": "string",
          "minLength": 1,
          "description": "The note content"
        },
        "subject": {
          "type": "string",
          "minLength": 1,
          "description": "Primary subject of the note (entity, location, concept)"
        },
        "subjectType": {
          "type": "string",
          "enum": [
            "character",
            "location",
            "item",
            "creature",
            "event",
            "concept",
            "relationship",
            "organization",
            "quest",
            "skill",
            "emotion",
            "plan",
            "timeline",
            "theory",
            "observation",
            "knowledge_state",
            "psychological_state",
            "other"
          ],
          "default": "other",
          "description": "Explicit categorization of the note's subject type"
        },
        "context": {
          "type": "string",
          "description": "Where/how this was observed (optional)"
        },
        "timestamp": {
          "type": "string",
          "format": "date-time",
          "description": "When the note was created"
        }
      },
      "required": ["text", "subject", "subjectType"],
      "additionalProperties": false
    }
  }
}
