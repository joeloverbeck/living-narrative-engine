{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "schema://living-narrative-engine/debug-logging-config.schema.json",
  "title": "Debug Logging Configuration Schema",
  "description": "Complete schema for debug logging system configuration including validation, defaults, and support for both client and server configurations",
  "type": "object",
  "properties": {
    "$schema": {
      "type": "string",
      "description": "JSON Schema reference URI"
    },
    "enabled": {
      "type": "boolean",
      "description": "Enable or disable the entire logging system",
      "default": true
    },
    "mode": {
      "type": "string",
      "enum": [
        "console",
        "remote",
        "hybrid",
        "test",
        "none",
        "development",
        "production"
      ],
      "description": "Logging mode determining output destination",
      "default": "development"
    },
    "fallbackToConsole": {
      "type": "boolean",
      "description": "Whether to fallback to console logging when remote logging fails",
      "default": true
    },
    "logLevel": {
      "type": "string",
      "enum": ["DEBUG", "INFO", "WARN", "ERROR", "NONE"],
      "description": "Global log level (legacy support)",
      "default": "INFO"
    },
    "remote": {
      "type": "object",
      "description": "Remote logging configuration",
      "properties": {
        "endpoint": {
          "type": "string",
          "format": "uri",
          "description": "Remote logging endpoint URL",
          "default": "http://localhost:3001/api/debug-log"
        },
        "batchSize": {
          "type": "integer",
          "minimum": 1,
          "maximum": 1000,
          "description": "Number of logs to batch before sending",
          "default": 100
        },
        "flushInterval": {
          "type": "integer",
          "minimum": 100,
          "maximum": 10000,
          "description": "Flush interval in milliseconds",
          "default": 1000
        },
        "retryAttempts": {
          "type": "integer",
          "minimum": 0,
          "maximum": 5,
          "description": "Number of retry attempts for failed requests",
          "default": 3
        },
        "retryBaseDelay": {
          "type": "integer",
          "minimum": 100,
          "maximum": 60000,
          "description": "Base delay for retry attempts in milliseconds",
          "default": 1000
        },
        "retryMaxDelay": {
          "type": "integer",
          "minimum": 1000,
          "maximum": 300000,
          "description": "Maximum delay for retry attempts in milliseconds",
          "default": 30000
        },
        "retryDelay": {
          "type": "integer",
          "minimum": 100,
          "maximum": 60000,
          "description": "Retry delay in milliseconds (legacy support)",
          "default": 1000
        },
        "circuitBreakerThreshold": {
          "type": "integer",
          "minimum": 1,
          "maximum": 100,
          "description": "Number of failures before circuit breaker activates",
          "default": 5
        },
        "circuitBreakerTimeout": {
          "type": "integer",
          "minimum": 10000,
          "maximum": 600000,
          "description": "Circuit breaker timeout in milliseconds",
          "default": 60000
        },
        "requestTimeout": {
          "type": "integer",
          "minimum": 1000,
          "maximum": 30000,
          "description": "HTTP request timeout in milliseconds",
          "default": 5000
        },
        "compression": {
          "type": "boolean",
          "description": "Enable compression for remote requests",
          "default": false
        }
      },
      "additionalProperties": false
    },
    "categories": {
      "type": "object",
      "description": "Per-category logging configuration",
      "additionalProperties": {
        "type": "object",
        "properties": {
          "enabled": {
            "type": "boolean",
            "description": "Enable logging for this category",
            "default": true
          },
          "level": {
            "type": "string",
            "enum": ["debug", "info", "warn", "error", "none"],
            "description": "Log level for this category",
            "default": "info"
          }
        },
        "required": ["enabled", "level"],
        "additionalProperties": false
      }
    },
    "console": {
      "type": "object",
      "description": "Console logging configuration",
      "properties": {
        "enabled": {
          "type": "boolean",
          "description": "Enable console output",
          "default": true
        },
        "useColors": {
          "type": "boolean",
          "description": "Use colored output in console",
          "default": true
        },
        "showTimestamp": {
          "type": "boolean",
          "description": "Show timestamps in console output",
          "default": false
        },
        "showCategory": {
          "type": "boolean",
          "description": "Show log categories in console output",
          "default": true
        },
        "groupSimilar": {
          "type": "boolean",
          "description": "Group similar log messages",
          "default": true
        }
      },
      "additionalProperties": false
    },
    "performance": {
      "type": "object",
      "description": "Performance monitoring configuration",
      "properties": {
        "enableMetrics": {
          "type": "boolean",
          "description": "Enable performance metrics collection",
          "default": true
        },
        "metricsInterval": {
          "type": "integer",
          "minimum": 1000,
          "maximum": 300000,
          "description": "Metrics collection interval in milliseconds",
          "default": 60000
        },
        "memoryWarningThreshold": {
          "type": "integer",
          "minimum": 10,
          "maximum": 1000,
          "description": "Memory warning threshold in MB",
          "default": 100
        },
        "slowLogThreshold": {
          "type": "integer",
          "minimum": 100,
          "maximum": 10000,
          "description": "Slow operation threshold in milliseconds",
          "default": 1000
        }
      },
      "additionalProperties": false
    },
    "filtering": {
      "type": "object",
      "description": "Sensitive data filtering configuration",
      "properties": {
        "enabled": {
          "type": "boolean",
          "description": "Enable sensitive data filtering",
          "default": true
        },
        "strategy": {
          "type": "string",
          "enum": ["mask", "partial", "hash", "remove"],
          "description": "Default replacement strategy for sensitive data",
          "default": "mask"
        },
        "patterns": {
          "type": "object",
          "description": "Custom patterns for sensitive data detection",
          "additionalProperties": {
            "type": "string",
            "description": "Regular expression pattern as string"
          }
        },
        "strategies": {
          "type": "object",
          "description": "Custom replacement strategies",
          "additionalProperties": {
            "type": "string",
            "description": "Replacement strategy implementation"
          }
        }
      },
      "additionalProperties": false
    },
    "categorization": {
      "type": "object",
      "description": "Source-based categorization configuration for log routing",
      "properties": {
        "strategy": {
          "type": "string",
          "enum": ["source-based", "pattern-based", "hybrid"],
          "description": "Categorization strategy - source-based uses file paths, pattern-based uses message patterns, hybrid uses both",
          "default": "hybrid"
        },
        "enableStackTraceExtraction": {
          "type": "boolean",
          "description": "Enable stack trace extraction for source-based categorization",
          "default": true
        },
        "sourceMappings": {
          "type": "object",
          "description": "Mapping from source directory paths to category names",
          "additionalProperties": {
            "type": "string",
            "description": "Category name for this source directory"
          },
          "default": {
            "src/actions": "actions",
            "src/logic": "logic",
            "src/entities": "entities",
            "src/ai": "ai",
            "src/domUI": "domUI",
            "src/engine": "engine",
            "src/events": "events",
            "src/loaders": "loaders",
            "src/scopeDsl": "scopeDsl",
            "src/initializers": "initializers",
            "src/dependencyInjection": "dependencyInjection",
            "src/logging": "logging",
            "src/configuration": "configuration",
            "src/utils": "utils",
            "src/constants": "constants",
            "src/storage": "storage",
            "src/types": "types",
            "src/alerting": "alerting",
            "src/context": "context",
            "src/turns": "turns",
            "src/adapters": "adapters",
            "src/query": "query",
            "src/characterBuilder": "characterBuilder",
            "src/prompting": "prompting",
            "src/anatomy": "anatomy",
            "src/scheduling": "scheduling",
            "src/errors": "errors",
            "src/interfaces": "interfaces",
            "src/clothing": "clothing",
            "src/input": "input",
            "src/testing": "testing",
            "src/modding": "modding",
            "src/persistence": "persistence",
            "src/data": "data",
            "src/shared": "shared",
            "src/bootstrapper": "bootstrapper",
            "src/commands": "commands",
            "src/thematicDirection": "thematicDirection",
            "src/models": "models",
            "src/llms": "llms",
            "src/validation": "validation",
            "src/pathing": "pathing",
            "src/formatting": "formatting",
            "src/ports": "ports",
            "src/shutdown": "shutdown",
            "src/clichesGenerator": "clichesGenerator",
            "src/coreMotivationsGenerator": "coreMotivationsGenerator",
            "src/thematicDirectionsManager": "thematicDirectionsManager",
            "src/services": "services",
            "tests": "tests",
            "llm-proxy-server": "llm-proxy"
          }
        },
        "fallbackCategory": {
          "type": "string",
          "description": "Category to use when source cannot be determined",
          "default": "general"
        },
        "levelBasedRouting": {
          "type": "object",
          "description": "Route specific log levels to different outputs",
          "properties": {
            "error": {
              "type": "string",
              "description": "Output file or destination for error logs",
              "default": "error.jsonl"
            },
            "warn": {
              "type": "string", 
              "description": "Output file or destination for warning logs",
              "default": "warning.jsonl"
            }
          },
          "additionalProperties": {
            "type": "string"
          }
        },
        "migration": {
          "type": "object",
          "description": "Migration settings for progressive rollout",
          "properties": {
            "mode": {
              "type": "string",
              "enum": ["progressive", "immediate", "test"],
              "description": "Migration rollout mode",
              "default": "progressive"
            },
            "preserveOldPatterns": {
              "type": "boolean",
              "description": "Keep existing pattern-based categorization active during migration",
              "default": true
            },
            "enableDualCategorization": {
              "type": "boolean",
              "description": "Enable both pattern and source categorization for comparison",
              "default": false
            }
          },
          "additionalProperties": false
        },
        "performance": {
          "type": "object", 
          "description": "Performance tuning for source-based categorization",
          "properties": {
            "stackTrace": {
              "type": "object",
              "description": "Stack trace extraction settings",
              "properties": {
                "enabled": {
                  "type": "boolean",
                  "description": "Enable stack trace extraction",
                  "default": true
                },
                "skipFrames": {
                  "type": "integer",
                  "minimum": 0,
                  "maximum": 10,
                  "description": "Number of stack frames to skip",
                  "default": 4
                },
                "maxDepth": {
                  "type": "integer",
                  "minimum": 5,
                  "maximum": 50,
                  "description": "Maximum stack trace depth to analyze",
                  "default": 20
                },
                "cache": {
                  "type": "object",
                  "description": "Stack trace caching settings",
                  "properties": {
                    "enabled": {
                      "type": "boolean",
                      "description": "Enable source path caching",
                      "default": true
                    },
                    "maxSize": {
                      "type": "integer",
                      "minimum": 50,
                      "maximum": 1000,
                      "description": "Maximum cache entries",
                      "default": 200
                    },
                    "ttl": {
                      "type": "integer",
                      "minimum": 60000,
                      "maximum": 3600000,
                      "description": "Cache TTL in milliseconds",
                      "default": 300000
                    }
                  },
                  "additionalProperties": false
                }
              },
              "additionalProperties": false
            },
            "fileOperations": {
              "type": "object",
              "description": "File operation optimization settings",
              "properties": {
                "bufferSize": {
                  "type": "integer",
                  "minimum": 10,
                  "maximum": 1000,
                  "description": "Buffer size for file writes",
                  "default": 100
                },
                "flushInterval": {
                  "type": "integer",
                  "minimum": 100,
                  "maximum": 10000,
                  "description": "File flush interval in milliseconds",
                  "default": 1000
                },
                "parallelWrites": {
                  "type": "boolean",
                  "description": "Enable parallel file writes",
                  "default": true
                },
                "maxFileHandles": {
                  "type": "integer",
                  "minimum": 10,
                  "maximum": 200,
                  "description": "Maximum concurrent file handles",
                  "default": 50
                }
              },
              "additionalProperties": false
            }
          },
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    },
    "criticalLogging": {
      "type": "object",
      "description": "Critical logging configuration for warnings and errors",
      "properties": {
        "alwaysShowInConsole": {
          "type": "boolean",
          "description": "Always show warnings and errors in console regardless of filters",
          "default": true
        },
        "enableVisualNotifications": {
          "type": "boolean",
          "description": "Enable visual notifications for critical logs",
          "default": true
        },
        "bufferSize": {
          "type": "integer",
          "minimum": 10,
          "maximum": 100,
          "description": "Size of the critical log buffer",
          "default": 50
        },
        "notificationPosition": {
          "type": "string",
          "enum": ["top-right", "top-left", "bottom-right", "bottom-left"],
          "description": "Position of visual notifications on screen",
          "default": "top-right"
        },
        "autoDismissAfter": {
          "oneOf": [
            {
              "type": "integer",
              "minimum": 1000,
              "maximum": 30000,
              "description": "Auto-dismiss notifications after milliseconds"
            },
            {
              "type": "null",
              "description": "Don't auto-dismiss notifications"
            }
          ],
          "default": null
        },
        "soundEnabled": {
          "type": "boolean",
          "default": false,
          "description": "Play sound when critical logs occur (optional feature)"
        },
        "minimumLevel": {
          "type": "string",
          "enum": ["warn", "error"],
          "default": "warn",
          "description": "Minimum level to consider as critical (warn includes both warnings and errors)"
        }
      },
      "additionalProperties": false
    }
  },
  "required": ["enabled", "mode"],
  "additionalProperties": false
}
